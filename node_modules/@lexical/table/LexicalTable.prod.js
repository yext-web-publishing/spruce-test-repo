/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';var d=require("lexical"),t=require("@lexical/utils");let w=/^(\d+(?:\.\d+)?)px$/,x={BOTH:3,COLUMN:2,NO_STATUS:0,ROW:1};
class y extends d.DEPRECATED_GridCellNode{static getType(){return"tablecell"}static clone(a){let b=new y(a.__headerState,a.__colSpan,a.__width,a.__key);b.__rowSpan=a.__rowSpan;b.__backgroundColor=a.__backgroundColor;return b}static importDOM(){return{td:()=>({conversion:z,priority:0}),th:()=>({conversion:z,priority:0})}}static importJSON(a){let b=a.rowSpan||1,c=B(a.headerState,a.colSpan||1,a.width||void 0);c.__rowSpan=b;c.__backgroundColor=a.backgroundColor||null;return c}constructor(a=x.NO_STATUS,
b=1,c,e){super(b,e);this.__headerState=a;this.__width=c;this.__backgroundColor=null}createDOM(a){let b=document.createElement(this.getTag());this.__width&&(b.style.width=`${this.__width}px`);1<this.__colSpan&&(b.colSpan=this.__colSpan);1<this.__rowSpan&&(b.rowSpan=this.__rowSpan);null!==this.__backgroundColor&&(b.style.backgroundColor=this.__backgroundColor);t.addClassNamesToElement(b,a.theme.tableCell,this.hasHeader()&&a.theme.tableCellHeader);return b}exportDOM(a){({element:a}=super.exportDOM(a));
if(a){var b=this.getParentOrThrow().getChildrenSize();a.style.border="1px solid black";1<this.__colSpan&&(a.colSpan=this.__colSpan);1<this.__rowSpan&&(a.rowSpan=this.__rowSpan);a.style.width=`${this.getWidth()||Math.max(90,700/b)}px`;a.style.verticalAlign="top";a.style.textAlign="start";b=this.getBackgroundColor();null!==b?a.style.backgroundColor=b:this.hasHeader()&&(a.style.backgroundColor="#f2f3f5")}return{element:a}}exportJSON(){return{...super.exportJSON(),backgroundColor:this.getBackgroundColor(),
headerState:this.__headerState,type:"tablecell",width:this.getWidth()}}getTag(){return this.hasHeader()?"th":"td"}setHeaderStyles(a){this.getWritable().__headerState=a;return this.__headerState}getHeaderStyles(){return this.getLatest().__headerState}setWidth(a){this.getWritable().__width=a;return this.__width}getWidth(){return this.getLatest().__width}getBackgroundColor(){return this.getLatest().__backgroundColor}setBackgroundColor(a){this.getWritable().__backgroundColor=a}toggleHeaderStyle(a){let b=
this.getWritable();b.__headerState=(b.__headerState&a)===a?b.__headerState-a:b.__headerState+a;return b}hasHeaderState(a){return(this.getHeaderStyles()&a)===a}hasHeader(){return this.getLatest().__headerState!==x.NO_STATUS}updateDOM(a){return a.__headerState!==this.__headerState||a.__width!==this.__width||a.__colSpan!==this.__colSpan||a.__rowSpan!==this.__rowSpan||a.__backgroundColor!==this.__backgroundColor}isShadowRoot(){return!0}collapseAtStart(){return!0}canBeEmpty(){return!1}canIndent(){return!1}}
function z(a){var b=a.nodeName.toLowerCase();let c=void 0;w.test(a.style.width)&&(c=parseFloat(a.style.width));b=B("th"===b?x.ROW:x.NO_STATUS,a.colSpan,c);b.__rowSpan=a.rowSpan;a=a.style.backgroundColor;""!==a&&(b.__backgroundColor=a);return{forChild:(e,g)=>{if(C(g)&&!d.$isElementNode(e)){g=d.$createParagraphNode();if(d.$isLineBreakNode(e)&&"\n"===e.getTextContent())return null;g.append(e);return g}return e},node:b}}function B(a,b=1,c){return d.$applyNodeReplacement(new y(a,b,c))}
function C(a){return a instanceof y}
class D extends d.DEPRECATED_GridRowNode{static getType(){return"tablerow"}static clone(a){return new D(a.__height,a.__key)}static importDOM(){return{tr:()=>({conversion:aa,priority:0})}}static importJSON(a){return E(a.height)}constructor(a,b){super(b);this.__height=a}exportJSON(){return{...super.exportJSON(),type:"tablerow",version:1}}createDOM(a){let b=document.createElement("tr");this.__height&&(b.style.height=`${this.__height}px`);t.addClassNamesToElement(b,a.theme.tableRow);return b}isShadowRoot(){return!0}setHeight(a){this.getWritable().__height=
a;return this.__height}getHeight(){return this.getLatest().__height}updateDOM(a){return a.__height!==this.__height}canBeEmpty(){return!1}canIndent(){return!1}}function aa(a){let b=void 0;w.test(a.style.height)&&(b=parseFloat(a.style.height));return{node:E(b)}}function E(a){return d.$applyNodeReplacement(new D(a))}function F(a){return a instanceof D}
function G(a){let b=new URLSearchParams;b.append("code",a);for(let c=1;c<arguments.length;c++)b.append("v",arguments[c]);throw Error(`Minified Lexical error #${a}; visit https://lexical.dev/docs/error?${b} for the full message or `+"use the non-minified dev environment for full errors and additional helpful warnings.");}let ba="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement;
class H{constructor(a,b){this.isHighlightingCells=!1;this.focusY=this.focusX=this.anchorY=this.anchorX=-1;this.listenersToRemove=new Set;this.tableNodeKey=b;this.editor=a;this.grid={cells:[],columns:0,rows:0};this.focusCell=this.anchorCell=this.focusCellNodeKey=this.anchorCellNodeKey=this.gridSelection=null;this.hasHijackedSelectionStyles=!1;this.trackTableGrid()}getGrid(){return this.grid}removeListeners(){Array.from(this.listenersToRemove).forEach(a=>a())}trackTableGrid(){let a=new MutationObserver(b=>
{this.editor.update(()=>{var c=!1;for(let e=0;e<b.length;e++){const g=b[e].target.nodeName;if("TABLE"===g||"TR"===g){c=!0;break}}if(c){c=this.editor.getElementByKey(this.tableNodeKey);if(!c)throw Error("Expected to find TableElement in DOM");this.grid=I(c)}})});this.editor.update(()=>{let b=this.editor.getElementByKey(this.tableNodeKey);if(!b)throw Error("Expected to find TableElement in DOM");this.grid=I(b);a.observe(b,{childList:!0,subtree:!0})})}clearHighlight(){let a=this.editor;this.isHighlightingCells=
!1;this.focusY=this.focusX=this.anchorY=this.anchorX=-1;this.focusCell=this.anchorCell=this.focusCellNodeKey=this.anchorCellNodeKey=this.gridSelection=null;this.hasHijackedSelectionStyles=!1;this.enableHighlightStyle();a.update(()=>{var b=d.$getNodeByKey(this.tableNodeKey);if(!K(b))throw Error("Expected TableNode.");b=a.getElementByKey(this.tableNodeKey);if(!b)throw Error("Expected to find TableElement in DOM");b=I(b);L(a,b,null);d.$setSelection(null);a.dispatchCommand(d.SELECTION_CHANGE_COMMAND,
void 0)})}enableHighlightStyle(){let a=this.editor;a.update(()=>{let b=a.getElementByKey(this.tableNodeKey);if(!b)throw Error("Expected to find TableElement in DOM");t.removeClassNamesFromElement(b,a._config.theme.tableSelection);b.classList.remove("disable-selection");this.hasHijackedSelectionStyles=!1})}disableHighlightStyle(){let a=this.editor;a.update(()=>{let b=a.getElementByKey(this.tableNodeKey);if(!b)throw Error("Expected to find TableElement in DOM");t.addClassNamesToElement(b,a._config.theme.tableSelection);
this.hasHijackedSelectionStyles=!0})}updateTableGridSelection(a){if(null!=a&&a.gridKey===this.tableNodeKey){let b=this.editor;this.gridSelection=a;this.isHighlightingCells=!0;this.disableHighlightStyle();L(b,this.grid,this.gridSelection)}else null==a?this.clearHighlight():(this.tableNodeKey=a.gridKey,this.updateTableGridSelection(a))}setFocusCellForSelection(a,b=!1){let c=this.editor;c.update(()=>{var e=d.$getNodeByKey(this.tableNodeKey);if(!K(e))throw Error("Expected TableNode.");if(!c.getElementByKey(this.tableNodeKey))throw Error("Expected to find TableElement in DOM");
e=a.x;let g=a.y;this.focusCell=a;if(null!==this.anchorCell){let k=ba?(c._window||window).getSelection():null;k&&k.setBaseAndExtent(this.anchorCell.elem,0,this.focusCell.elem,0)}if(!this.isHighlightingCells&&(this.anchorX!==e||this.anchorY!==g||b))this.isHighlightingCells=!0,this.disableHighlightStyle();else if(e===this.focusX&&g===this.focusY)return;this.focusX=e;this.focusY=g;this.isHighlightingCells&&(e=d.$getNearestNodeFromDOMNode(a.elem),null!=this.gridSelection&&null!=this.anchorCellNodeKey&&
C(e)&&(e=e.getKey(),this.gridSelection=this.gridSelection.clone()||d.DEPRECATED_$createGridSelection(),this.focusCellNodeKey=e,this.gridSelection.set(this.tableNodeKey,this.anchorCellNodeKey,this.focusCellNodeKey),d.$setSelection(this.gridSelection),c.dispatchCommand(d.SELECTION_CHANGE_COMMAND,void 0),L(c,this.grid,this.gridSelection)))})}setAnchorCellForSelection(a){this.isHighlightingCells=!1;this.anchorCell=a;this.anchorX=a.x;this.anchorY=a.y;this.editor.update(()=>{var b=d.$getNearestNodeFromDOMNode(a.elem);
C(b)&&(b=b.getKey(),this.gridSelection=null!=this.gridSelection?this.gridSelection.clone():d.DEPRECATED_$createGridSelection(),this.anchorCellNodeKey=b)})}formatCells(a){this.editor.update(()=>{let b=d.$getSelection();d.DEPRECATED_$isGridSelection(b)||G(11);let c=d.$createRangeSelection(),e=c.anchor,g=c.focus;b.getNodes().forEach(k=>{C(k)&&0!==k.getTextContentSize()&&(e.set(k.getKey(),0,"element"),g.set(k.getKey(),k.getChildrenSize(),"element"),c.formatText(a))});d.$setSelection(b);this.editor.dispatchCommand(d.SELECTION_CHANGE_COMMAND,
void 0)})}clearText(){let a=this.editor;a.update(()=>{let b=d.$getNodeByKey(this.tableNodeKey);if(!K(b))throw Error("Expected TableNode.");var c=d.$getSelection();d.DEPRECATED_$isGridSelection(c)||G(11);c=c.getNodes().filter(C);c.length===this.grid.columns*this.grid.rows?(b.selectPrevious(),b.remove(),d.$getRoot().selectStart()):(c.forEach(e=>{if(d.$isElementNode(e)){let g=d.$createParagraphNode(),k=d.$createTextNode();g.append(k);e.append(g);e.getChildren().forEach(f=>{f!==g&&f.remove()})}}),L(a,
this.grid,null),d.$setSelection(null),a.dispatchCommand(d.SELECTION_CHANGE_COMMAND,void 0))})}}function M(a){for(;null!=a;){let b=a.nodeName;if("TD"===b||"TH"===b){a=a._cell;if(void 0===a)break;return a}a=a.parentNode}return null}
function I(a){let b=[],c={cells:b,columns:0,rows:0};var e=a.firstChild;let g=a=0;for(b.length=0;null!=e;){var k=e.nodeName;if("TD"===k||"TH"===k){k=e;k={elem:k,hasBackgroundColor:""!==k.style.backgroundColor,highlighted:!1,x:a,y:g};e._cell=k;let f=b[g];void 0===f&&(f=b[g]=[]);f[a]=k}else if(k=e.firstChild,null!=k){e=k;continue}k=e.nextSibling;if(null!=k)a++,e=k;else if(k=e.parentNode,null!=k){e=k.nextSibling;if(null==e)break;g++;a=0}}c.columns=a+1;c.rows=g+1;return c}
function L(a,b,c){let e=new Set(c?c.getNodes():[]);N(b,(g,k)=>{let f=g.elem;e.has(k)?(g.highlighted=!0,ca(a,g)):(g.highlighted=!1,da(a,g),f.getAttribute("style")||f.removeAttribute("style"))})}function N(a,b){({cells:a}=a);for(let c=0;c<a.length;c++){let e=a[c];if(e)for(let g=0;g<e.length;g++){let k=e[g];if(!k)continue;let f=d.$getNearestNodeFromDOMNode(k.elem);null!==f&&b(k,f,{x:g,y:c})}}}function ea(a,b){b.disableHighlightStyle();N(b.grid,c=>{c.highlighted=!0;ca(a,c)})}
function fa(a,b){b.enableHighlightStyle();N(b.grid,c=>{let e=c.elem;c.highlighted=!1;da(a,c);e.getAttribute("style")||e.removeAttribute("style")})}
let ha=(a,b,c,e,g)=>{const k="forward"===g;switch(g){case "backward":case "forward":return c!==(k?a.grid.columns-1:0)?(a=b.getCellNodeFromCordsOrThrow(c+(k?1:-1),e,a.grid),k?a.selectStart():a.selectEnd()):e!==(k?a.grid.rows-1:0)?(a=b.getCellNodeFromCordsOrThrow(k?0:a.grid.columns-1,e+(k?1:-1),a.grid),k?a.selectStart():a.selectEnd()):k?b.selectNext():b.selectPrevious(),!0;case "up":return 0!==e?b.getCellNodeFromCordsOrThrow(c,e-1,a.grid).selectEnd():b.selectPrevious(),!0;case "down":return e!==a.grid.rows-
1?b.getCellNodeFromCordsOrThrow(c,e+1,a.grid).selectStart():b.selectNext(),!0;default:return!1}},ia=(a,b,c,e,g)=>{const k="forward"===g;switch(g){case "backward":case "forward":return c!==(k?a.grid.columns-1:0)&&a.setFocusCellForSelection(b.getCellFromCordsOrThrow(c+(k?1:-1),e,a.grid)),!0;case "up":return 0!==e?(a.setFocusCellForSelection(b.getCellFromCordsOrThrow(c,e-1,a.grid)),!0):!1;case "down":return e!==a.grid.rows-1?(a.setFocusCellForSelection(b.getCellFromCordsOrThrow(c,e+1,a.grid)),!0):!1;
default:return!1}};function O(a,b){if(d.$isRangeSelection(a)||d.DEPRECATED_$isGridSelection(a)){let c=b.isParentOf(a.anchor.getNode());a=b.isParentOf(a.focus.getNode());return c&&a}return!1}
function ca(a,b){a=b.elem;b=d.$getNearestNodeFromDOMNode(a);C(b)||G(131);null===b.getBackgroundColor()?a.style.setProperty("background-color","rgb(172,206,247)"):a.style.setProperty("background-image","linear-gradient(to right, rgba(172,206,247,0.85), rgba(172,206,247,0.85))");a.style.setProperty("caret-color","transparent")}
function da(a,b){a=b.elem;b=d.$getNearestNodeFromDOMNode(a);C(b)||G(131);null===b.getBackgroundColor()&&a.style.removeProperty("background-color");a.style.removeProperty("background-image");a.style.removeProperty("caret-color")}function P(a){a=t.$findMatchingParent(a,C);return C(a)?a:null}function Q(a){a=t.$findMatchingParent(a,K);return K(a)?a:null}
function R(a,b,c,e,g){let k=d.$getSelection();if(!O(k,e))return!1;if(d.$isRangeSelection(k)&&k.isCollapsed()){if("backward"===c||"forward"===c)return!1;let {anchor:r,focus:h}=k;var f=t.$findMatchingParent(r.getNode(),C),m=t.$findMatchingParent(h.getNode(),C);if(!C(f)||!f.is(m))return!1;m=Q(f);if(m!==e&&null!=m){var p=a.getElementByKey(m.getKey());if(null!=p)return g.grid=I(p),R(a,b,c,m,g)}m=a.getElementByKey(f.__key);p=a.getElementByKey(r.key);if(null==p||null==m)return!1;if("element"===r.type)m=
p.getBoundingClientRect();else{m=window.getSelection();if(null===m||0===m.rangeCount)return!1;m=m.getRangeAt(0).getBoundingClientRect()}p="up"===c?f.getFirstChild():f.getLastChild();if(null==p)return!1;a=a.getElementByKey(p.__key);if(null==a)return!1;a=a.getBoundingClientRect();if("up"===c?a.top>m.top-m.height:m.bottom+m.height>a.bottom){S(b);a=e.getCordsFromCellNode(f,g.grid);if(b.shiftKey)c=e.getCellFromCordsOrThrow(a.x,a.y,g.grid),g.setAnchorCellForSelection(c),g.setFocusCellForSelection(c,!0);
else return ha(g,e,a.x,a.y,c);return!0}}else if(d.DEPRECATED_$isGridSelection(k)){let {anchor:r,focus:h}=k;p=t.$findMatchingParent(r.getNode(),C);m=t.$findMatchingParent(h.getNode(),C);[f]=k.getNodes();a=a.getElementByKey(f.getKey());if(!C(p)||!C(m)||!K(f)||null==a)return!1;g.updateTableGridSelection(k);a=I(a);p=e.getCordsFromCellNode(p,a);p=e.getCellFromCordsOrThrow(p.x,p.y,a);g.setAnchorCellForSelection(p);S(b);if(b.shiftKey)return b=e.getCordsFromCellNode(m,a),ia(g,f,b.x,b.y,c);m.selectEnd();return!0}return!1}
function S(a){a.preventDefault();a.stopImmediatePropagation();a.stopPropagation()}
class T extends d.DEPRECATED_GridNode{static getType(){return"table"}static clone(a){return new T(a.__key)}static importDOM(){return{table:()=>({conversion:ja,priority:1})}}static importJSON(){return U()}constructor(a){super(a)}exportJSON(){return{...super.exportJSON(),type:"table",version:1}}createDOM(a){let b=document.createElement("table");t.addClassNamesToElement(b,a.theme.table);return b}updateDOM(){return!1}exportDOM(a){return{...super.exportDOM(a),after:b=>{if(b){let c=b.cloneNode(),e=document.createElement("colgroup"),
g=document.createElement("tbody");t.isHTMLElement(b)&&g.append(...b.children);b=this.getFirstChildOrThrow();if(!F(b))throw Error("Expected to find row node.");b=b.getChildrenSize();for(let k=0;k<b;k++){let f=document.createElement("col");e.append(f)}c.replaceChildren(e,g);return c}}}}canExtractContents(){return!1}canBeEmpty(){return!1}isShadowRoot(){return!0}getCordsFromCellNode(a,b){let {rows:c,cells:e}=b;for(b=0;b<c;b++){var g=e[b];if(null!=g&&(g=g.findIndex(k=>{if(k)return{elem:k}=k,d.$getNearestNodeFromDOMNode(k)===
a}),-1!==g))return{x:g,y:b}}throw Error("Cell not found in table.");}getCellFromCords(a,b,c){({cells:c}=c);b=c[b];if(null==b)return null;a=b[a];return null==a?null:a}getCellFromCordsOrThrow(a,b,c){a=this.getCellFromCords(a,b,c);if(!a)throw Error("Cell not found at cords.");return a}getCellNodeFromCords(a,b,c){a=this.getCellFromCords(a,b,c);if(null==a)return null;a=d.$getNearestNodeFromDOMNode(a.elem);return C(a)?a:null}getCellNodeFromCordsOrThrow(a,b,c){a=this.getCellNodeFromCords(a,b,c);if(!a)throw Error("Node at cords not TableCellNode.");
return a}canSelectBefore(){return!0}canIndent(){return!1}}function ja(){return{node:U()}}function U(){return d.$applyNodeReplacement(new T)}function K(a){return a instanceof T}function V(a){a=t.$findMatchingParent(a,b=>F(b));if(F(a))return a;throw Error("Expected table cell to be inside of table row.");}function X(a){a=t.$findMatchingParent(a,b=>K(b));if(K(a))return a;throw Error("Expected table cell to be inside of table.");}
function ka(a,b){let c=X(a),{x:e,y:g}=c.getCordsFromCellNode(a,b);return{above:c.getCellNodeFromCords(e,g-1,b),below:c.getCellNodeFromCords(e,g+1,b),left:c.getCellNodeFromCords(e-1,g,b),right:c.getCellNodeFromCords(e+1,g,b)}}function Y(a){let b=a.getFirstDescendant();null==b?a.selectStart():b.getParentOrThrow().selectStart()}function Z(a,b){let c=a.getFirstChild();null!==c?c.insertBefore(b):a.append(b)}let la=d.createCommand("INSERT_TABLE_COMMAND");exports.$createTableCellNode=B;
exports.$createTableNode=U;exports.$createTableNodeWithDimensions=function(a,b,c=!0){let e=U();for(let k=0;k<a;k++){let f=E();for(let m=0;m<b;m++){var g=x.NO_STATUS;"object"===typeof c?(0===k&&c.rows&&(g|=x.ROW),0===m&&c.columns&&(g|=x.COLUMN)):c&&(0===k&&(g|=x.ROW),0===m&&(g|=x.COLUMN));g=B(g);let p=d.$createParagraphNode();p.append(d.$createTextNode());g.append(p);f.append(g)}e.append(f)}return e};exports.$createTableRowNode=E;
exports.$deleteTableColumn=function(a,b){let c=a.getChildren();for(let g=0;g<c.length;g++){var e=c[g];if(F(e)){e=e.getChildren();if(b>=e.length||0>b)throw Error("Table column target index out of range");e[b].remove()}}return a};
exports.$deleteTableColumn__EXPERIMENTAL=function(){var a=d.$getSelection();if(!d.$INTERNAL_isPointSelection(a))throw Error("Expected a INTERNAL_PointSelection");var b=a.anchor.getNode();a=a.focus.getNode();let [c,,e]=d.DEPRECATED_$getNodeTriplet(b);[b]=d.DEPRECATED_$getNodeTriplet(a);let [g,k,f]=d.DEPRECATED_$computeGridMap(e,c,b);var {startColumn:m}=k;let {startRow:p,startColumn:r}=f;a=Math.min(m,r);m=Math.max(m+c.__colSpan-1,r+b.__colSpan-1);let h=m-a+1;if(g[0].length===m-a+1)e.selectPrevious(),
e.remove();else{var l=g.length;for(let n=0;n<l;n++)for(let q=a;q<=m;q++){let {cell:v,startColumn:u}=g[n][q];u<a?q===a&&v.setColSpan(v.__colSpan-Math.min(h,v.__colSpan-(a-u))):u+v.__colSpan-1>m?q===m&&v.setColSpan(v.__colSpan-(m-u+1)):v.remove()}a=g[p];b=a[r+b.__colSpan];void 0!==b?({cell:b}=b,Y(b)):({cell:b}=a[r-1],Y(b))}};
exports.$deleteTableRow__EXPERIMENTAL=function(){var a=d.$getSelection();if(!d.$INTERNAL_isPointSelection(a))throw Error("Expected a INTERNAL_PointSelection");var b=a.anchor.getNode();a=a.focus.getNode();let [c,,e]=d.DEPRECATED_$getNodeTriplet(b);[a]=d.DEPRECATED_$getNodeTriplet(a);let [g,k,f]=d.DEPRECATED_$computeGridMap(e,c,a);({startRow:b}=k);var {startRow:m}=f;a=m+a.__rowSpan-1;if(g.length===a-b+1)e.remove();else{m=g[0].length;var p=g[a+1],r=e.getChildAtIndex(a+1);for(let l=a;l>=b;l--){for(var h=
m-1;0<=h;h--){let {cell:n,startRow:q,startColumn:v}=g[l][h];if(v===h&&(l===b&&q<b&&n.setRowSpan(n.__rowSpan-(q-b)),q>=b&&q+n.__rowSpan-1>a))if(n.setRowSpan(n.__rowSpan-(a-q+1)),null===r&&G(122),0===h)Z(r,n);else{let {cell:u}=p[h-1];u.insertAfter(n)}}h=e.getChildAtIndex(l);d.DEPRECATED_$isGridRowNode(h)||G(123,String(l));h.remove()}void 0!==p?({cell:b}=p[0],Y(b)):({cell:b}=g[b-1][0],Y(b))}};
exports.$getElementGridForTableNode=function(a,b){a=a.getElementByKey(b.getKey());if(null==a)throw Error("Table Element Not Found");return I(a)};exports.$getTableCellNodeFromLexicalNode=function(a){a=t.$findMatchingParent(a,b=>C(b));return C(a)?a:null};exports.$getTableColumnIndexFromTableCellNode=function(a){return V(a).getChildren().findIndex(b=>b.is(a))};exports.$getTableNodeFromLexicalNodeOrThrow=X;
exports.$getTableRowIndexFromTableCellNode=function(a){let b=V(a);return X(b).getChildren().findIndex(c=>c.is(b))};exports.$getTableRowNodeFromTableCellNodeOrThrow=V;
exports.$insertTableColumn=function(a,b,c=!0,e,g){let k=a.getChildren(),f=[];for(let r=0;r<k.length;r++){let h=k[r];if(F(h))for(let l=0;l<e;l++){var m=h.getChildren();if(b>=m.length||0>b)throw Error("Table column target index out of range");m=m[b];C(m)||G(12);let {left:n,right:q}=ka(m,g);var p=x.NO_STATUS;if(n&&n.hasHeaderState(x.ROW)||q&&q.hasHeaderState(x.ROW))p|=x.ROW;p=B(p);p.append(d.$createParagraphNode());f.push({newTableCell:p,targetCell:m})}}f.forEach(({newTableCell:r,targetCell:h})=>{c?
h.insertAfter(r):h.insertBefore(r)});return a};
exports.$insertTableColumn__EXPERIMENTAL=function(a=!0){function b(){let l=B(x.NO_STATUS).append(d.$createParagraphNode());null===r&&(r=l);return l}var c=d.$getSelection();if(!d.$INTERNAL_isPointSelection(c))throw Error("Expected a PointSeleciton");var e=c.anchor.getNode();c=c.focus.getNode();[e]=d.DEPRECATED_$getNodeTriplet(e);let [g,,k]=d.DEPRECATED_$getNodeTriplet(c),[f,m,p]=d.DEPRECATED_$computeGridMap(k,g,e);e=f.length;c=a?Math.max(m.startColumn,p.startColumn):Math.min(m.startColumn,p.startColumn);
a=a?c+g.__colSpan-1:c-1;c=k.getFirstChild();d.DEPRECATED_$isGridRowNode(c)||G(120);let r=null;var h=c;a:for(c=0;c<e;c++){0!==c&&(h=h.getNextSibling(),d.DEPRECATED_$isGridRowNode(h)||G(121));let l=f[c];if(0>a){Z(h,b());continue}let {cell:n,startColumn:q,startRow:v}=l[a];if(q+n.__colSpan-1<=a){let u=n,A=v,J=a;for(;A!==c&&1<u.__rowSpan;)if(J-=n.__colSpan,0<=J){let {cell:W,startRow:ma}=l[J];u=W;A=ma}else{h.append(b());continue a}u.insertAfter(b())}else n.setColSpan(n.__colSpan+1)}null!==r&&Y(r)};
exports.$insertTableRow=function(a,b,c=!0,e,g){var k=a.getChildren();if(b>=k.length||0>b)throw Error("Table row target index out of range");b=k[b];if(F(b))for(k=0;k<e;k++){let m=b.getChildren(),p=m.length,r=E();for(let h=0;h<p;h++){var f=m[h];C(f)||G(12);let {above:l,below:n}=ka(f,g);f=x.NO_STATUS;let q=l&&l.getWidth()||n&&n.getWidth()||void 0;if(l&&l.hasHeaderState(x.COLUMN)||n&&n.hasHeaderState(x.COLUMN))f|=x.COLUMN;f=B(f,1,q);f.append(d.$createParagraphNode());r.append(f)}c?b.insertAfter(r):b.insertBefore(r)}else throw Error("Row before insertion index does not exist.");
return a};
exports.$insertTableRow__EXPERIMENTAL=function(a=!0){var b=d.$getSelection();if(!d.$INTERNAL_isPointSelection(b))throw Error("Expected a INTERNAL_PointSelection");b=b.focus.getNode();let [c,,e]=d.DEPRECATED_$getNodeTriplet(b),[g,k]=d.DEPRECATED_$computeGridMap(e,c,c);b=g[0].length;var {startRow:f}=k;if(a){a=f+c.__rowSpan-1;var m=g[a];f=E();for(var p=0;p<b;p++){let {cell:r,startRow:h}=m[p];h+r.__rowSpan-1<=a?f.append(B(x.NO_STATUS)):r.setRowSpan(r.__rowSpan+1)}b=e.getChildAtIndex(a);d.DEPRECATED_$isGridRowNode(b)||G(119);
b.insertAfter(f)}else{m=g[f];a=E();for(p=0;p<b;p++){let {cell:r,startRow:h}=m[p];h===f?a.append(B(x.NO_STATUS)):r.setRowSpan(r.__rowSpan+1)}b=e.getChildAtIndex(f);d.DEPRECATED_$isGridRowNode(b)||G(119);b.insertBefore(a)}};exports.$isTableCellNode=C;exports.$isTableNode=K;exports.$isTableRowNode=F;exports.$removeTableRowAtIndex=function(a,b){let c=a.getChildren();if(b>=c.length||0>b)throw Error("Expected table cell to be inside of table row.");c[b].remove();return a};
exports.$unmergeCell=function(){var a=d.$getSelection();if(!d.$INTERNAL_isPointSelection(a))throw Error("Expected a INTERNAL_PointSelection");a=a.anchor.getNode();let [b,c,e]=d.DEPRECATED_$getNodeTriplet(a);a=b.__colSpan;let g=b.__rowSpan;if(1<a){for(var k=1;k<a;k++)b.insertAfter(B(x.NO_STATUS));b.setColSpan(1)}if(1<g){let [p,r]=d.DEPRECATED_$computeGridMap(e,b,b),{startColumn:h,startRow:l}=r,n;for(k=1;k<g;k++){var f=l+k;let q=p[f];n=(n||c).getNextSibling();d.DEPRECATED_$isGridRowNode(n)||G(125);
var m=null;for(let v=0;v<h;v++){let u=q[v],A=u.cell;u.startRow===f&&(m=A);1<A.__colSpan&&(v+=A.__colSpan-1)}if(null===m)for(m=0;m<a;m++)Z(n,B(x.NO_STATUS));else for(f=0;f<a;f++)m.insertAfter(B(x.NO_STATUS))}b.setRowSpan(1)}};exports.INSERT_TABLE_COMMAND=la;exports.TableCellHeaderStates=x;exports.TableCellNode=y;exports.TableNode=T;exports.TableRowNode=D;exports.TableSelection=H;
exports.applyTableHandlers=function(a,b,c,e){function g(h){h=a.getCordsFromCellNode(h,f.grid);return a.getCellFromCordsOrThrow(h.x,h.y,f.grid)}let k=c.getRootElement();if(null===k)throw Error("No root element.");let f=new H(c,a.getKey()),m=c._window||window;b.__lexicalTableSelection=f;b.addEventListener("mousedown",h=>{setTimeout(()=>{if(0===h.button&&m){var l=M(h.target);null!==l&&(S(h),f.setAnchorCellForSelection(l));var n=()=>{m.removeEventListener("mouseup",n);m.removeEventListener("mousemove",
q)},q=v=>{const u=M(v.target);null===u||f.anchorX===u.x&&f.anchorY===u.y||(v.preventDefault(),f.setFocusCellForSelection(u))};m.addEventListener("mouseup",n);m.addEventListener("mousemove",q)}},0)});let p=h=>{0===h.button&&c.update(()=>{const l=d.$getSelection(),n=h.target;d.DEPRECATED_$isGridSelection(l)&&l.gridKey===f.tableNodeKey&&k.contains(n)&&f.clearHighlight()})};m.addEventListener("mousedown",p);f.listenersToRemove.add(()=>m.removeEventListener("mousedown",p));f.listenersToRemove.add(c.registerCommand(d.KEY_ARROW_DOWN_COMMAND,
h=>R(c,h,"down",a,f),d.COMMAND_PRIORITY_HIGH));f.listenersToRemove.add(c.registerCommand(d.KEY_ARROW_UP_COMMAND,h=>R(c,h,"up",a,f),d.COMMAND_PRIORITY_HIGH));f.listenersToRemove.add(c.registerCommand(d.KEY_ARROW_LEFT_COMMAND,h=>R(c,h,"backward",a,f),d.COMMAND_PRIORITY_HIGH));f.listenersToRemove.add(c.registerCommand(d.KEY_ARROW_RIGHT_COMMAND,h=>R(c,h,"forward",a,f),d.COMMAND_PRIORITY_HIGH));f.listenersToRemove.add(c.registerCommand(d.KEY_ESCAPE_COMMAND,h=>{var l=d.$getSelection();return d.DEPRECATED_$isGridSelection(l)&&
(l=t.$findMatchingParent(l.focus.getNode(),C),C(l))?(S(h),l.selectEnd(),!0):!1},d.COMMAND_PRIORITY_HIGH));let r=h=>()=>{var l=d.$getSelection();if(!O(l,a))return!1;if(d.DEPRECATED_$isGridSelection(l))return f.clearText(),!0;if(d.$isRangeSelection(l)){const v=t.$findMatchingParent(l.anchor.getNode(),u=>C(u));if(!C(v))return!1;var n=l.anchor.getNode(),q=l.focus.getNode();n=a.isParentOf(n);q=a.isParentOf(q);if(n&&!q||q&&!n)return f.clearText(),!0;n=(q=t.$findMatchingParent(l.anchor.getNode(),u=>d.$isElementNode(u)))&&
t.$findMatchingParent(q,u=>d.$isElementNode(u)&&C(u.getParent()));if(!d.$isElementNode(n)||!d.$isElementNode(q))return!1;if(h===d.DELETE_LINE_COMMAND&&null===n.getPreviousSibling())return!0;if((h===d.DELETE_CHARACTER_COMMAND||h===d.DELETE_WORD_COMMAND)&&l.isCollapsed()&&0===l.anchor.offset&&q!==n){l=q.getChildren();const u=d.$createParagraphNode();l.forEach(A=>u.append(A));q.replace(u);q.getWritable().__parent=v.getKey();return!0}}return!1};[d.DELETE_WORD_COMMAND,d.DELETE_LINE_COMMAND,d.DELETE_CHARACTER_COMMAND].forEach(h=>
{f.listenersToRemove.add(c.registerCommand(h,r(h),d.COMMAND_PRIORITY_CRITICAL))});b=h=>{const l=d.$getSelection();if(!O(l,a))return!1;if(d.DEPRECATED_$isGridSelection(l))return h.preventDefault(),h.stopPropagation(),f.clearText(),!0;d.$isRangeSelection(l)&&(h=t.$findMatchingParent(l.anchor.getNode(),n=>C(n)),C(h));return!1};f.listenersToRemove.add(c.registerCommand(d.KEY_BACKSPACE_COMMAND,b,d.COMMAND_PRIORITY_CRITICAL));f.listenersToRemove.add(c.registerCommand(d.KEY_DELETE_COMMAND,b,d.COMMAND_PRIORITY_CRITICAL));
f.listenersToRemove.add(c.registerCommand(d.FORMAT_TEXT_COMMAND,h=>{let l=d.$getSelection();if(!O(l,a))return!1;if(d.DEPRECATED_$isGridSelection(l))return f.formatCells(h),!0;d.$isRangeSelection(l)&&(h=t.$findMatchingParent(l.anchor.getNode(),n=>C(n)),C(h));return!1},d.COMMAND_PRIORITY_CRITICAL));f.listenersToRemove.add(c.registerCommand(d.CONTROLLED_TEXT_INSERTION_COMMAND,()=>{var h=d.$getSelection();if(!O(h,a))return!1;d.DEPRECATED_$isGridSelection(h)?f.clearHighlight():d.$isRangeSelection(h)&&
(h=t.$findMatchingParent(h.anchor.getNode(),l=>C(l)),C(h));return!1},d.COMMAND_PRIORITY_CRITICAL));e&&f.listenersToRemove.add(c.registerCommand(d.KEY_TAB_COMMAND,h=>{var l=d.$getSelection();if(!d.$isRangeSelection(l)||!l.isCollapsed()||!O(l,a))return!1;l=P(l.anchor.getNode());if(null===l)return!1;S(h);l=a.getCordsFromCellNode(l,f.grid);ha(f,a,l.x,l.y,h.shiftKey?"backward":"forward");return!0},d.COMMAND_PRIORITY_CRITICAL));f.listenersToRemove.add(c.registerCommand(d.FOCUS_COMMAND,()=>a.isSelected(),
d.COMMAND_PRIORITY_HIGH));f.listenersToRemove.add(c.registerCommand(d.SELECTION_CHANGE_COMMAND,()=>{let h=d.$getSelection(),l=d.$getPreviousSelection();if(d.$isRangeSelection(h)){let {anchor:A,focus:J}=h;var n=A.getNode(),q=J.getNode();n=P(n);q=P(q);var v=n&&a.is(Q(n)),u=q&&a.is(Q(q));let W=v!==u;u=v&&u;v=h.isBackward();W?(n=h.clone(),n.focus.set(a.getKey(),v?0:a.getChildrenSize(),"element"),d.$setSelection(n),ea(c,f)):u&&!n.is(q)&&(f.setAnchorCellForSelection(g(n)),f.setFocusCellForSelection(g(q),
!0))}if(h&&!h.is(l)&&(d.DEPRECATED_$isGridSelection(h)||d.DEPRECATED_$isGridSelection(l))&&f.gridSelection&&!f.gridSelection.is(l))return d.DEPRECATED_$isGridSelection(h)&&h.gridKey===f.tableNodeKey?f.updateTableGridSelection(h):!d.DEPRECATED_$isGridSelection(h)&&d.DEPRECATED_$isGridSelection(l)&&l.gridKey===f.tableNodeKey&&f.updateTableGridSelection(null),!1;f.hasHijackedSelectionStyles&&!a.isSelected()?fa(c,f):!f.hasHijackedSelectionStyles&&a.isSelected()&&ea(c,f);return!1},d.COMMAND_PRIORITY_CRITICAL));
return f};exports.getCellFromTarget=M;exports.getTableSelectionFromTableElement=function(a){return a.__lexicalTableSelection}
